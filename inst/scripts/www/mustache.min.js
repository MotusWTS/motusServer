!function(a,b){"object"===typeof exports&&exports&&"string"!==typeof exports.nodeName?b(exports):"function"===typeof define&&define.amd?define(["exports"],b):(a.Mustache={},b(a.Mustache))}(this,function(a){function d(a){return"function"===typeof a}function e(a){return c(a)?"array":typeof a}function f(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function g(a,b){return null!=a&&"object"===typeof a&&b in a}function i(a,b){return h.call(a,b)}function k(a){return!i(j,a)}function m(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return l[a]})}function s(b,d){function l(){if(i&&!j)for(;h.length;)delete g[h.pop()];else h=[];i=!1,j=!1}function x(a){if("string"===typeof a&&(a=a.split(o,2)),!c(a)||2!==a.length)throw new Error("Invalid tags: "+a);m=new RegExp(f(a[0])+"\\s*"),s=new RegExp("\\s*"+f(a[1])),w=new RegExp("\\s*"+f("}"+a[1]))}if(!b)return[];var m,s,w,e=[],g=[],h=[],i=!1,j=!1;x(d||a.tags);for(var z,A,B,C,D,E,y=new v(b);!y.eos();){if(z=y.pos,B=y.scanUntil(m))for(var F=0,G=B.length;F<G;++F)C=B.charAt(F),k(C)?h.push(g.length):j=!0,g.push(["text",C,z,z+1]),z+=1,"\n"===C&&l();if(!y.scan(m))break;if(i=!0,A=y.scan(r)||"name",y.scan(n),"="===A?(B=y.scanUntil(p),y.scan(p),y.scanUntil(s)):"{"===A?(B=y.scanUntil(w),y.scan(q),y.scanUntil(s),A="&"):B=y.scanUntil(s),!y.scan(s))throw new Error("Unclosed tag at "+y.pos);if(D=[A,B,z,y.pos],g.push(D),"#"===A||"^"===A||"@"===A)e.push(D);else if("/"===A){if(E=e.pop(),!E)throw new Error('Unopened section "'+B+'" at '+z);if(E[1]!==B)throw new Error('Unclosed section "'+E[1]+'" at '+z)}else"name"===A||"{"===A||"&"===A?j=!0:"="===A&&x(B)}if(E=e.pop())throw new Error('Unclosed section "'+E[1]+'" at '+y.pos);return u(t(g))}function t(a){for(var c,d,b=[],e=0,f=a.length;e<f;++e)c=a[e],c&&("text"===c[0]&&d&&"text"===d[0]?(d[1]+=c[1],d[3]=c[3]):(b.push(c),d=c));return b}function u(a){for(var e,f,b=[],c=b,d=[],g=0,h=a.length;g<h;++g)switch(e=a[g],e[0]){case"#":case"^":case"@":c.push(e),d.push(e),c=e[4]=[];break;case"/":f=d.pop(),f[5]=e[2],c=d.length>0?d[d.length-1][4]:b;break;default:c.push(e)}return b}function v(a){this.string=a,this.tail=a,this.pos=0}function w(a,b){this.view=a,this.cache={".":this.view},this.parent=b}function x(){this.cache={}}var b=Object.prototype.toString,c=Array.isArray||function(a){return"[object Array]"===b.call(a)},h=RegExp.prototype.test,j=/\S/,l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},n=/\s*/,o=/\s+/,p=/\s*=/,q=/\s*\}/,r=/#|@|\^|\/|>|\{|&|=|!/;v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},v.prototype.scanUntil=function(a){var c,b=this.tail.search(a);switch(b){case-1:c=this.tail,this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,b),this.tail=this.tail.substring(b)}return this.pos+=c.length,c},w.prototype.push=function(a){return new w(a,this)},w.prototype.lookup=function(a,b){var e,c=this.cache;if(c.hasOwnProperty(a))e=c[a];else{for(var h,b,f=this,i=!1;f;){if(a.indexOf(".")>0)for(e=f.view,h=a.split("."),b=0;null!=e&&b<h.length;)b===h.length-1&&(i=g(e,h[b])),e=e[h[b++]];else e=f.view[a],i=g(f.view,a);if(i)break;f=f.parent}c[a]=e}return d(e)?e=e.call(this.view):Array.isArray(e)&&void 0!==b&&(e=e[b%e.length]),e},x.prototype.clearCache=function(){this.cache={}},x.prototype.parse=function(b,c){var d=this.cache,e=d[b];return null==e&&(e=d[b+":"+(c||a.tags).join(":")]=s(b,c)),e},x.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof w?b:new w(b);return this.renderTokens(d,e,c,a)},x.prototype.renderTokens=function(a,b,c,d,e){for(var g,h,i,f="",j=0,k=a.length;j<k;++j)i=void 0,g=a[j],h=g[0],"#"===h?i=this.renderSection(g,b,c,d,e):"@"===h?i=this.renderDeepSection(g,b,c,d,e):"^"===h?i=this.renderInverted(g,b,c,d,e):">"===h?i=this.renderPartial(g,b,c,d,e):"&"===h?i=this.unescapedValue(g,b,e):"name"===h?i=this.escapedValue(g,b,e):"text"===h&&(i=this.rawValue(g)),void 0!==i&&(f+=i);return f},x.prototype.renderSection=function(a,b,e,f,g){function k(a){return h.render(a,b,e)}var h=this,i="",j=b.lookup(a[1],g);if(j){if(c(j))for(var l=0,m=j.length;l<m;++l)i+=this.renderTokens(a[4],b.push(j[l]),e,f,g);else if("object"===typeof j||"string"===typeof j||"number"===typeof j)i+=this.renderTokens(a[4],b.push(j),e,f,g);else if(d(j)){if("string"!==typeof f)throw new Error("Cannot use higher-order sections without the original template");j=j.call(b.view,f.slice(a[3],a[5]),k),null!=j&&(i+=j)}else i+=this.renderTokens(a[4],b,e,f,g);return i}},x.prototype.renderDeepSection=function(a,b,c,d,e){var g="",h=b.lookup(a[1],e);if(h){if("object"===typeof h)for(var j=0,k=Math.max.apply(null,Object.keys(h).map(function(a){return h[a]instanceof Array?h[a].length:1}));j<k;++j)g+=this.renderTokens(a[4],b.push(h),c,d,j);return g}},x.prototype.renderInverted=function(a,b,d,e){var g=b.lookup(a[1]);return!g||c(g)&&0===g.length?this.renderTokens(a[4],b,d,e):void 0},x.prototype.renderPartial=function(a,b,c){if(c){var e=d(c)?c(a[1]):c[a[1]];return null!=e?this.renderTokens(this.parse(e),b,c,e,index):void 0}},x.prototype.unescapedValue=function(a,b,c){var d=b.lookup(a[1],c);return null!=d?d:void 0},x.prototype.escapedValue=function(b,c,d){var e=c.lookup(b[1],d);return null!=e?a.escape(e):void 0},x.prototype.rawValue=function(a){return a[1]},a.name="mustache.js",a.version="2.3.0oa",a.tags=["{{","}}"];var y=new x;return a.clearCache=function(){return y.clearCache()},a.parse=function(a,b){return y.parse(a,b)},a.render=function(a,b,c){if("string"!==typeof a)throw new TypeError('Invalid template! Template should be a "string" but "'+e(a)+'" was given as the first argument for mustache#render(template, view, partials)');return y.render(a,b,c)},a.to_html=function(b,c,e,f){var g=a.render(b,c,e);return d(f)?void f(g):g},a.escape=m,a.Scanner=v,a.Context=w,a.Writer=x,a});
