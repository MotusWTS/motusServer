---
title: "Work Log: Registration of Paul Smith's Shorebird Tag Database with sensorgnome.org and motus-wts.org"
author: "John Brzustowski"
date: "December, 2015"
output:
   pdf_document :
       toc: true
       toc_depth: 4
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(comment="")
options(warn=0)
```

```{r child="functions.Rmd", echo=FALSE, include=FALSE, cache=TRUE}
```

# Summary

Paul Smith has assembled a spreadsheet giving metadata for deployments
of coded ID tags on North American shorebirds from 2012 to 2015.  This
document records how this spreadsheet was reconciled with existing tag
registrations at sensorgnome.org and motus-wts.org.  As much as
possible, the steps here were coded as functions in the _motus_ R
package, so that other projects could more easily get their tag
metadata into motus-wts.org

Most of the tags listed in the spreadsheet could be linked to tags registered
with motus-wts.org, or at least with sensorgnome.org.  The remaining tags are discussed along the way, and labelled __[Sjoerd]__ to indicate he may be able to
resolve the problems.

# Preliminaries

First, read the list of projects from motus:

```{r, results="hide"}
library(motus, quietly=TRUE)
motusLoadSecrets("~/.secrets/motusSecrets.json")
projs = motusListProjects()
```

Next, read the spreadsheet.  We copied the entire sheet and pasted as
values into a new sheet, which was saved as a .CSV file.  We had tried
to read the sheet using the `readxl::read_excel()` function, but this
did not work well because in some columns (e.g. TrackerID), values
were present as both numbers and as textual output of formulas.  The
current version of `read_excel()` function doesn't handle a
heterogenous column very well.

```{r}
x = read.csv("paul_smith_shorebird_tag_metadata_noformatting.csv", as.is=TRUE)
x = as.tbl(x)
x
```

Make some changes we'll need later:
```{r warning=FALSE}
x = x %>%
    mutate(
        ## fix burst intervals
        Burst = Burst %>%
            ## drop tildes: e.g.change ~6 to 6
            sub("^~", "", .) %>%
            ## change ranges to integer portion of 2nd value
            ## e.g. 5.9 / 6.1 -> 6
            sub("([0-9]+\\.[0-9]+) / (([0-9]+)\\.[0-9]+)", "\\3", perl=TRUE, .) %>%
            as.numeric
    )
            
```

We matched names in the spreadsheet to motus projects, using a simple gui
as shown in Appendix 4.

```{r warning=FALSE, include=FALSE}
pmapFile = "projectMap.rds"
## inverse project map, from motusID to spreadsheetname
pmap = readRDS(pmapFile)
pmapi = character()
pmapi[pmap$motusID] = pmap$spreadsheetName
```

This leads to the following correspondence

```{r, echo=FALSE}
pmap = as.tbl(pmap)
pmap
## make a lookup table
projID = structure(as.list(pmap$motusID), names = pmap$spreadsheetName)
## add some entries explicitly
projID[["Kate Obrien"]] = 25
projID[["EBM Coats"]] = 66
projID[["Holbt"]] = 8
```

Now get the full tag databases from sensorgnome.org for 2012-2015

```{r, cache=TRUE}
sg = rbind(
    cbind( year=2012, read.csv("2012_tags.csv", as.is=TRUE)),
    cbind( year=2013, read.csv("2013_tags.csv", as.is=TRUE)),
    ## drop two extra columns from recent tag DBs
    cbind( year=2014, read.csv("2014_tags.csv", as.is=TRUE)[, 1:15]),
    cbind( year=2015, read.csv("2015_tags.csv", as.is=TRUE)[, 1:15])
) %>% as.tbl
sg
```

# Tags Already Registered With Motus

First we find determine which of the tags have already been registered
with motus.  The code loops through each spreadsheet project, trying
to match those tags against the ones registered with motus under the
corresponding project.

```{r, cached=TRUE, warning=FALSE}
found = multi = collide = lost = NULL

## sets of motus-registered tags
motus = NULL

for (p in pmap$spreadsheetName) {
    ## lookup the motus projectID
    pid = projID[[p]]
    
    ## get tags registered for this project with motus
    motusp = getProjectTags(pid)

    ## look just at spreadsheet tags for this project
    xp = x %>% filter(name == p)

    ## match spreadsheet tags to motus tags
    m = matchTags(xp, motusp, "TrackerID", "Burst", "Yr")

    found = found %>% rbind( m$unique )
    multi = multi %>% rbind( m$multi )
    collide = collide %>% rbind (m$collide)
    lost  = lost  %>% rbind( m$none )
    
    ## add motus tags from this project to full set
    motus = motus %>% rbind (motusp)
}
```

## Results of Initial Matching

Out of `r nrow(x)` tags,

 * `r nrow(found) %or% 'none'` had unique matches in the motus registry
 * `r (nrow(multi) - sum(duplicated(multi[, 1:ncol(x)])))  %or% 'none'` had multiple matches; i.e. matched to more than one tag in the motus database.
 * `r nrow(collide) %or% 'none'` collided; i.e. matched to the same
 motus tag as at least one other user tag.  These will be saved in
 `2015_paul_smith_shorebird_tag_collisions.rds`. We need to determine
 which of these are typos, and which are true re-deployments of
 tags. **[Sjoerd]**
 * `r nrow(lost) %or% 'none'` had no matches; for these, the distribution across name and year is:

```{r}
table(lost$name, lost$Yr)
```
## Registrations to 'wrong' project

We look for registrations of tags to the wrong project.
First, remove the unique matches and collision from the motus set
```{r}
used = c(found$tagID, collide$tagID)
motus = motus %>% subset(! tagID %in% used)
```
Now, get additional registration from projects "EBM Coats" and "Obrien":

```{r}
motus = motus %>%
    bind_rows(getProjectTags(projID[["EBM Coats"]])) %>%
    bind_rows(getProjectTags(projID[["Kate Obrien"]]))
```

Next, look for 'lost' tags across all projects in the corresponding year.

```{r}
m2 = matchTags(lost, motus, "TrackerID", "Burst", "Yr")
remap = m2$unique %>% mutate(newProjectID = unlist(projID[name]))
found = found %>% bind_rows(m2$unique)
lost = m2$none
```

This leads to a total of `r nrow(m2$unique)` tags which need to be reassigned
between projects, by year:

```{r}
table(remap$name,pmapi[remap$projectID], remap$Yr, dnn=c("New Name", "Original Name", "Year"))
## save the remap set, if not already generated on a previous run
reassignFile = "2015_paul_smith_shorebird_tag_reassign_projects.rds"
saveRDS(remap, reassignFile)
## write to small .csv file for Denis Lepage
remap %>%
    select(tagID, projectID, newProjectID) %>%
    write.csv("2015_paul_smith_shorebird_tag_reassign_project.csv", row.names = FALSE)
```

There are still `r nrow(lost)` tags not matched:

```{r}
table(lost$name, lost$Yr)
```

# Tags Not Yet Registered With Motus

We work by project on the unmatched tags.

## Christian Friis Tags 2014-2015

These tags are not found:

```{r}
P = "Christian Friis"
pid = projID[[P]]

cf = lost %>% filter( name==P) %>% arrange(Yr, TrackerID)
cf %>% select(Yr, TrackerID, Burst)

```

#### Tag 172
This tag was missing on the first run, but has since been registered.
Here is the code used:

```{r, cached=TRUE, eval=FALSE}
## only run once

if (172 %in% as.numeric(cf$mfgID)) {
    ## Tag 172 from 2015 was a twin of that from project Selva, so dropped.
    ## Read its parameters from the database of James Bay project tags
    tmp = read.csv("/disco/SG/contrib/2015/JamesBay/2015_JamesBay_tag_database.csv", as.is=TRUE) %>%
        subset(id == 172)

    regts = ymd("2015-05-30")

    try({
        with(tmp, 
             motusRegisterTag(
                 projectID = pid,
                 mfgID = "172",
                 manufacturer = "Lotek",
                 type = "ID",
                 codeSet = "Lotek-4",
                 offsetFreq = dfreq + (fcdFreq - tagFreq) * 1000,
                 period = bi,
                 periodSD = bi.sd,
                 pulseLen = 2.5,
                 param1 = g1,
                 param2 = g2,
                 param3 = g3,
                 param4 = g1.sd,
                 param5 = g2.sd,
                 param6 = g3.sd,
                 paramType = 1,
                 ts = as.numeric(regts),
                 nomFreq = tagFreq,
                 dateBin = sprintf("%4d-%1d", year(regts), ceiling(month(regts)/3)),
                 show = TRUE
             ))
    })
}
```

### Tags 376-379
These were registered, but the burst interval is ~9.7 s, not ~5.9s
as reported in the spreadsheet. **[Sjoerd]**

```{r, cached=TRUE}
bindUserMotus = function(u, m, fromLost=TRUE) {
    ## bind rows of user tags to motus tags, respectively
    if (nrow(u) != nrow(m))
        stop("need same number of rows in both parameters")
    ## lookup specified user rows in table of missing rows
    if (fromLost) {
        src = which(duplicated(rbind(u, lost))) - nrow(u)
        if (length(src) != nrow(u) | any(src < 1 | src > nrow(lost)))
            stop("specified user rows do not come from table 'lost'")
    }
    r = cbind(u, m)
    names(r)[names(r)=="comment"] = c("comment.x", "comment.y")
    found <<- found %>% bind_rows(r)
    if (fromLost)
        lost <<- lost[- src,]
    motus <<- motus %>% subset( ! tagID %in% m$tagID)
}

biFixId = 376:379

bindUserMotus(
    cf %>% filter(as.integer(TrackerID) %in% biFixId) %>% arrange(TrackerID),
    subset(motus,
           projectID==projID["Christian Friis"] &
           as.integer(mfgID) %in% (376:379)
           ) %>% arrange(mfgID)
)
```

The remaining 3 Friis tags, #226, 301, and 338 from 2014 with BI ~6s
have not been registered with sg or motus:

```{r}
needReg = subset(cf, as.integer(TrackerID) %in% c(226, 301, 338))
needReg %>% select(name, Yr, Month, Day, LocationID, TrackerID, Burst)
```

The deployment location matches the Piskwamish site.  226 shows up
with a BI of 5.8983s there, but neither 301 nor 338 is present.
Perhaps these two had mis-recorded ID numbers?  We register tag 226:

```{r, cached=TRUE, eval=FALSE}
## Read its parameters from the Lotek master database on the server
g = getLotekTagSig(226)

regts = ymd("2014-05-01")

try({
    motusRegisterTag(
        projectID = projID[["Christian Friis"]],
        mfgID = "226",
        manufacturer = "Lotek",
        type = "ID",
        codeSet = "Lotek-4",
        offsetFreq = 0,
        period = 5.8983,
        periodSD = 0,
        pulseLen = 2.5,
        param1 = g[1],
        param2 = g[2],
        param3 = g[3],
        param4 = 0,
        param5 = 0,
        param6 = 0,
        paramType = 1,
        ts = as.numeric(regts),
        nomFreq = 166.380,
        dateBin = sprintf("%4d-%1d", year(regts), ceiling(month(regts)/3))
    )
})
```

## Larry Niles Tags 2014 - 2015

These tags are not found:

```{r}
P = "Larry Niles"
pid = projID[[P]]
t = lost %>% filter( name==P) %>% arrange(Yr, TrackerID)
t %>% select(Yr, TrackerID, Burst)
```

But tags 244...261 and 511 are registered to Niles 2015 with BI ~6.1, and these
are otherwise unmatched, so the BI in the spreadsheet must be incorrect.
**[Sjoerd]**

```{r}

fixBI = c(244, 246:261, 511)

bindUserMotus(
    t %>% filter(as.integer(TrackerID) %in% fixBI),
    subset(motus, projectID == projID["Larry Niles"] &
                  as.integer(mfgID) %in% fixBI
           ) %>% arrange(mfgID)
    )
```
For 2014, these are still unmatched, due to lacking a Burst interval
in the spreadsheet:

```{r}
t = lost %>% filter( name==P & Yr==2014 ) %>% arrange(Yr, TrackerID)
t %>% select(TrackerID, Month, Day) %>% as.data.frame
```
Among the unmatched motus-registered tags for that year and project, these
have the same IDs:

```{r}
subset(motus, projectID==47 & grepl("2014", dateBin) & as.integer(mfgID) %in% as.integer(t$TrackerID))%>% select(mfgID,period) %>% as.data.frame
```

This shows all spreadsheet tags with unknown Burst can be matched to a unique
motus-registered tag, except for IDs 146 and 147, for which there are two
tags each, differing in BI.  We examined the detection database for 2014 and
found that it was the tags with Burst = ~5.3s which were deployed in September;
the other two were deployed in May.  So we match these tags:

```{r}
bindUserMotus(
    t,
    subset(motus,
           projectID==47 &
           grepl("2014", dateBin) &
           as.integer(mfgID) %in% as.integer(t$TrackerID) &
           ! mfgID %in% c("146.0", "147.0"))
    )
```

For 2015, there are still 2 unmatched Niles tags; these have unknown IDs:

```{r}
t = lost %>% filter( name==P & Yr==2015 ) %>% arrange(Yr, TrackerID)
t %>% subset(! as.integer(TrackerID) %in% fixBI)
```

These might be among the `r sum(sg$proj=="Niles") - sum(found$name=="Larry Niles")`
tags registered with sensorgnome to the Larry Niles project but for which
no metadata were provided in Paul's spreadsheet.

## Paul Smith 2015 Tags

There is a single tag left with __invalid__ ID 545:

```{r}
lost %>% filter(name=="Paul Smith") %>% as.data.frame
```

Perhaps it is either 454 or 445, both registered to motus project
_EBM Coats_, and not matched to any other tags in the spreadsheet.
**[Sjoerd]**

## Erica Nol 2014, 2015 Tags

These tags are still unmatched:

```{r}
P = "Erica Nol"
pid = projID[[P]]
t = lost %>% filter(name==P & Yr %in% c("2014", "2015")) %>%
    arrange(Yr, TrackerID)
t %>% select(Yr, TrackerID, Burst, Month, Day)
```
These were not registered, so we estimate their burst intervals
empirically from site data.
All of these tags except 306 were detected when the Churchill BirdCove
site from 2014 was re-run against the Lotek master database:

```{r}
bi = 
'ID, Burst
297,10.094879
298,10.095308
299,10.095086
300,10.095187
302,10.095269
303,10.095200
305,10.095217
307,10.295400
' %>% textConnection %>% read.csv
```

Unfortunately, tag 306 was not detected at any of the northern sites in 2014.
(Churchill Bird Cove and Fen, Nanuk, Longridge, Coats Island, Netitishi, Washkagou)
We register the rest:

```{r, eval=FALSE, cached=TRUE}
regts = ymd("2014-05-01")

for (i in 1:nrow(bi)) {
    g = getLotekTagSig(bi$ID[i])
    try({
        motusRegisterTag(
            projectID = projID[["Erica Nol"]],
        mfgID = as.character(bi$ID[i]),
        manufacturer = "Lotek",
        type = "ID",
        codeSet = "Lotek-4",
        offsetFreq = 0,
        period = bi$Burst[i],
        periodSD = 0,
        pulseLen = 2.5,
        param1 = g[1],
        param2 = g[2],
        param3 = g[3],
        param4 = 0,
        param5 = 0,
        param6 = 0,
        paramType = 1,
        ts = as.numeric(regts),
        nomFreq = 166.380,
        dateBin = sprintf("%4d-%1d", year(regts), ceiling(month(regts)/3))
        )
    })
}
```

## Rebecca Holberton / Kate Obrien / Lindsay Tudor 2013-2015 Tags

These tags are still unmatched for 2014, 2015:

```{r}
P = "Lindsay Tudor"
pid = projID[[P]]
t = lost %>% filter(name==P & Yr %in% c("2014", "2015")) %>%
    arrange(Yr, TrackerID)
t %>% select(Yr, TrackerID, Burst)
```
Tags 274, 275, and 276 apparently have the wrong Burst interval in the
spreadsheet, which lists 10.2 instead of the 8.9 common to the rest of
the tags in that set in the spreadsheet, and in Kate Obrien's registrations.

We match these:
```{r}

fixBI = 274:276

bindUserMotus(
    t %>% filter(as.integer(TrackerID) %in% fixBI),
    subset(motus, projectID == projID["Kate Obrien"] &
                  as.integer(mfgID) %in% fixBI
           ) %>% arrange(mfgID)
    )
```
This leaves only a single tag for _Lindsay Tudor_ in 2014 or 2015, namely
this one with no ID:

```{r}
lost %>% filter(name=="Lindsay Tudor" & Yr %in% c(2014,2015)) %>%
    select(name, Yr, LocationID, TrackerID, Burst)
```
It should be possible to find this one with a full search of POPH site
data.

### 2013 Holberton Tags

These still hadn't been registered with motus.  We do this now.

```{r}
t = lost %>% filter(name=="Lindsay Tudor" & Yr==2013) %>%
    mutate(iid = as.integer(TrackerID))

# skip the tags @ 166.38 MHz which were on RUTU
sgt = sg %>% filter(proj=="Holbt" & year==2013 & tagFreq==166.3) %>%
    mutate(iid = as.integer(id))

comb = t %>% left_join(sgt, by = "iid")
regts = ymd("2013-05-01")
```

```{r, eval=FALSE, cached=TRUE}
for (i in 1:nrow(comb)) {
    ## Note: these tags are in codeset 3, hence the "3" below:
    g = getLotekTagSig(comb$iid[i], "3")
    try({
        motusRegisterTag(
            projectID = projID[["Lindsay Tudor"]],
            mfgID = as.character(comb$iid[i]),
            manufacturer = "Lotek",
            type = "ID",
            codeSet = "Lotek-3",
            offsetFreq = 0,
            period = comb$bi[i],
            periodSD = 0,
            pulseLen = 2.5,
            param1 = g[1],
            param2 = g[2],
            param3 = g[3],
            param4 = 0,
            param5 = 0,
            param6 = 0,
            paramType = 1,
            ts = as.numeric(regts),
            nomFreq = 166.3,
            dateBin = sprintf("%4d-%1d", year(regts), ceiling(month(regts)/3))
        )
    })
}
```

With the 2013 Holberton tags registered, we bind them to spreadsheet
records:

```{r}
bindUserMotus(
    t %>% select( -iid ) %>% arrange(TrackerID), ## remove added column
    subset(motus,
           projectID==projID[["Holbt"]] & grepl("2013", dateBin)
           ) %>% arrange(mfgID)
)
```

## Diana Hamilton Tags 2012-2015

We had already registered the 2014-2015 tags with motus.  We now do the
same for 2012 and 2013.  These are all in codeset 3, and at 166.3 MHz.

### Register 2013 tags with motus

```{r}
t = lost %>% filter(name=="Diana Hamilton" & Yr==2013) %>%
    mutate(iid = as.integer(TrackerID))

sgt = sg %>% filter(proj=="Hamil" & year==2013) %>%
    mutate(iid = as.integer(id))

comb = t %>% left_join(sgt, by = "iid")
regts = ymd("2013-05-01")
```

Here's the code to do the registration.

```{r, eval=FALSE}
for (i in 1:nrow(comb)) {
    ## Note: these tags are in codeset 3, hence the "3" below:
    g = getLotekTagSig(comb$iid[i], "3")
    try({
        motusRegisterTag(
            projectID = projID[["Diana Hamilton"]],
            mfgID = as.character(comb$iid[i]),
            manufacturer = "Lotek",
            type = "ID",
            codeSet = "Lotek-3",
            offsetFreq = 0,
            period = comb$bi[i],
            periodSD = 0,
            pulseLen = 2.5,
            param1 = g[1],
            param2 = g[2],
            param3 = g[3],
            param4 = 0,
            param5 = 0,
            param6 = 0,
            paramType = 1,
            ts = as.numeric(regts),
            nomFreq = 166.3,
            dateBin = sprintf("%4d-%1d", year(regts), ceiling(month(regts)/3))
        )
    })
}

```

And now add these tags to the _found_ set:

```{r}
bindUserMotus(
    t %>% select ( -iid) %>% arrange (TrackerID),
    subset(motus,
           projectID==projID["Diana Hamilton"] &
           grepl("2013", dateBin)
           ) %>% arrange(mfgID)
)
```

### Register 2012 tags with motus

Now 2012:

```{r}
t = lost %>% filter(name=="Diana Hamilton" & Yr==2012) %>%
    mutate(iid = as.integer(TrackerID))

sgt = sg %>% filter(proj=="SESA" & year==2012) %>%
    mutate(iid = as.integer(id))

comb = t %>% left_join(sgt, by = "iid")
regts = ymd("2012-05-01")
```

and again, the code for registration

```{r, eval=FALSE}
for (i in 1:nrow(comb)) {
    ## Note: these tags are in codeset 3, hence the "3" below:
    g = getLotekTagSig(comb$iid[i], "3")
    try({
        motusRegisterTag(
            projectID = projID[["Diana Hamilton"]],
            mfgID = as.character(comb$iid[i]),
            manufacturer = "Lotek",
            type = "ID",
            codeSet = "Lotek-3",
            offsetFreq = 0,
            period = comb$bi[i],
            periodSD = 0,
            pulseLen = 2.5,
            param1 = g[1],
            param2 = g[2],
            param3 = g[3],
            param4 = 0,
            param5 = 0,
            param6 = 0,
            paramType = 1,
            ts = as.numeric(regts),
            nomFreq = 166.3,
            dateBin = sprintf("%4d-%1d", year(regts), ceiling(month(regts)/3))
        )
    })
}
```

And now add these tags to the _found_ set:

```{r}
bindUserMotus(
    t %>% select ( -iid) %>% arrange (TrackerID),
    subset(motus,
           projectID==projID["Diana Hamilton"] &
           grepl("2012", dateBin)
           ) %>% arrange(mfgID)
)
```

This leaves `r nrow(lost)` tags still not matched, all of them
discussed above.

```{r}
lost %>% select (name, Yr, Month, Day, TrackerID, Burst, LocationID, Latitude, Longitude)
```

# Tag Collisions

Some pairs of tags in the spreadsheet appear indistinguishable. If
true, detections of these tags have to be disambiguated by reference
to spatiotemporal context.  It's also possible collisions are due to
typos in the spreadsheet.  We examine each collision, but resolving
them may take some extra work. __[Sjoerd]__

Save the collisions in a file.

```{r} 
collide = collide %>% arrange (name, Yr, TrackerID)
saveRDS(collide, "2015_paul_smith_shorebird_tag_collisions.rds")
```

We examine each pair.

## Christian Friis Tag Collisions

There are two tags with ID #183 listed for Christian Friis:

```{r}
cc = collide %>% filter(name=='Christian Friis')
cc %>% select(Yr, Month, Day, TrackerID, Burst, LocationID, Latitude, Longitude)
```

only one tag with ID 183 was registered with motus for this project.
However, there is a tag #103 registered with motus and detected at the
North Point deployment site but not in the spreadsheet.  The two tags
have these two first dates of detection:

```{r, cached=TRUE, eval = FALSE}
"2015_JamesBay_NorthPoint_alltags.rds" %>%
    readRDS %>%
    as.tbl %>%
    filter(tagProj=='JamesBay' & id %in% c(103,183)) %>%
    group_by(fullID) %>%
    summarize(from=min(ts), to=max(ts))
```

So it seems clear the tag deployed later, on Aug. 25, was __103__,
rather than 183.  We make that change and bind the spreadsheet records
to those from motus:

```{r}
## both the spreadsheet and motus columns for tag 183 are already
## present in the collision tbl:
names(cc)[grepl("comments.*", names(cc))] = "comments"
bindUserMotus( cc[1, 1:31], cc[1, 32:67], fromLost=FALSE)
## for tag 103, we obtain the pieces from separate sources
bindUserMotus( cc[2, 1:31],
              motus %>% filter(
                            projectID==projID[['Christian Friis']] &
                            grepl("2015", dateBin) &
                            as.integer(mfgID) == 103
                        ),
              fromLost = FALSE
              )
```

## Larry Niles Tag Collisions
There are two pairs of colliding tags:

### ID = 314

```{r}
cc = collide %>% filter(name=='Larry Niles' & as.integer(TrackerID) == 314)
cc %>% select(Yr, Month, Day, TrackerID, Burst, LocationID, Latitude, Longitude)
```

For tags 314 and 314.1, the burst intervals should be different.
There are two tags with ID 314 registered with sensorgnome by Larry
Niles in 2015; one had BI 6.1s, and we referred to it as 314.1; the
other had BI 5.3s and we referred to it as 314.0.  It appears the
spreadsheet has the incorrect BI for the tag deployed May 18
(i.e. for 314.0), as the deployment date and location match detections
for the tag 314 with BI=5.3 seconds.  We fix this:

```{r}
names(cc)[grepl("comments.*", names(cc))] = "comments"
## tag 314.1 is indeed the one with a burst interval of 6.1s
bindUserMotus( cc[2, 1:31], cc[2, 32:67], fromLost=FALSE)

## for tag 314.0, we obtain the pieces from separate sources
bindUserMotus( cc[1, 1:31],
              motus %>% filter(
                            projectID==projID[['Larry Niles']] &
                            grepl("2015", dateBin) &
                            as.double(mfgID) == 314
                        ),
              fromLost = FALSE
              )
```

### ID = 345

```{r}
cc = collide %>% filter(name=='Larry Niles' & as.integer(TrackerID) == 345)
cc %>% select(Yr, Month, Day, TrackerID, Burst, LocationID, Latitude, Longitude)
```

There is a tag with BI=5.3 sec and ID=345 registered to Larry Niles in
2015, and detected at Fortescue starting May 14.  There does seem to
be some clustering on plots such as `freq` vs `burstSlop` of
detections of tag 345 when divided into sets before and after May 23,
so it's possible there _were_ two tag #345 with the same burst interval.
Context will be required for separating them.  Or was this a simple
redeployment of the same tag?

## Yves Aubry Tag Collisions
There are two tags with ID #204 listed for Yves Aubry

```{r}
cc = collide %>% filter(name=='Yves Aubry')
cc %>% select(Yr, Month, Day, TrackerID, Burst, LocationID, Latitude, Longitude)
```

It appears one of these should be listed as #203, as this ID was
registered by Yves for 2015, but does not appear in the spreadsheet.
There are no detections of tag 204 at Grande-ÃŽle or any of the nearby
sites, but tag 203 was detected there within this range of dates:

```{r}
"2015_Quebec_GrandeIle_alltags.rds" %>%
    readRDS %>%
    as.tbl %>%
    filter(tagProj=='Aubry' & id %in% c(203:204)) %>%
    group_by(fullID) %>%
    summarize(from=min(ts), to=max(ts))
```

Unfortunately, this is after the deployment date given for both of the
tag 204s in the spreadsheet, so we can't tell which metadata belong
to 203. It seems more likely that this is the tag deployed on Aug 11,
otherwise the tag would have gone undetected for 10 days, rather than
for 2 days.  Tag 204 has not been detected anywhere in the
network so far, but 203 was detected at several sites. For now, we do not process these two tags. __[Sjoerd]__

\newpage

```{r, child=c("appendix1.Rmd","appendix2.Rmd","appendix3.Rmd", "appendix4.Rmd")}
```

